<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.12: http://docutils.sourceforge.net/" />
<title>[-Wuseless-escape]</title>
<link rel="stylesheet" type="text/css" href="/css/default.css" />
<link rel="alternate" type="application/atom+xml" href="/feed/atom.xml" title="Atom 1.0" />
<link rel="icon" href="/favicon.ico" />
</head>
<body>
<div class="header">
<a class="reference external" href="../../../index.html">[home]</a> <a class="reference external" href="../../manual.html">[Manual]</a> <a class="reference external" href="../warnings.html">[Warnings]</a>
<hr class="header"/>
</div>
<div class="document" id="wuseless-escape">
<h1 class="title">[-Wuseless-escape]</h1>

<div class="contents topic" id="id3">
<p class="topic-title first">â˜…</p>
<ul class="simple">
<li><a class="reference internal" href="#a-simple-example" id="id4">A simple example</a></li>
<li><a class="reference internal" href="#how-it-works" id="id5">How it works</a></li>
<li><a class="reference internal" href="#real-world-examples" id="id6">Real-world examples</a></li>
</ul>
</div>
<div class="section" id="a-simple-example">
<h1>A simple example</h1>
<pre class="code cpp literal-block">
<span class="ln">1 </span><span class="comment multiline">/*!re2c
</span><span class="ln">2 </span><span class="comment multiline">    *                        {}
</span><span class="ln">3 </span><span class="comment multiline">    &quot;\a\A\&quot;\'\[\]\-\x5d\377&quot; {}
</span><span class="ln">4 </span><span class="comment multiline">    '\a\A\&quot;\'\[\]\-\x5d\377' {}
</span><span class="ln">5 </span><span class="comment multiline">    [\a\A\&quot;\'\[\]\-\x5d\377] {}
</span><span class="ln">6 </span><span class="comment multiline">*/</span>
</pre>
<p>Given this code, <tt class="docutils literal">`re2c <span class="pre">-Wuseless-escape`</span></tt> reports a bunch of warnings:</p>
<pre class="code literal-block">
re2c: warning: line 3: column 11: escape has no effect: '\A' [-Wuseless-escape]
re2c: warning: line 3: column 15: escape has no effect: '\'' [-Wuseless-escape]
re2c: warning: line 3: column 17: escape has no effect: '\[' [-Wuseless-escape]
re2c: warning: line 3: column 19: escape has no effect: '\]' [-Wuseless-escape]
re2c: warning: line 3: column 21: escape has no effect: '\-' [-Wuseless-escape]
re2c: warning: line 4: column 11: escape has no effect: '\A' [-Wuseless-escape]
re2c: warning: line 4: column 13: escape has no effect: '\&quot;' [-Wuseless-escape]
re2c: warning: line 4: column 17: escape has no effect: '\[' [-Wuseless-escape]
re2c: warning: line 4: column 19: escape has no effect: '\]' [-Wuseless-escape]
re2c: warning: line 4: column 21: escape has no effect: '\-' [-Wuseless-escape]
re2c: warning: line 5: column 11: escape has no effect: '\A' [-Wuseless-escape]
re2c: warning: line 5: column 13: escape has no effect: '\&quot;' [-Wuseless-escape]
re2c: warning: line 5: column 15: escape has no effect: '\'' [-Wuseless-escape]
re2c: warning: line 5: column 17: escape has no effect: '\[' [-Wuseless-escape]
</pre>
<p>It says that <tt class="docutils literal">\A</tt> and <tt class="docutils literal">\[</tt> escapes are meaningless in all rules,
<tt class="docutils literal">\-</tt> makes sense only in character class
and each type of closing quotes (<tt class="docutils literal">&quot;</tt>, <tt class="docutils literal">'</tt> and <tt class="docutils literal">]</tt>) should only be escaped inside of same-quoted string.
Useless escapes are ignored: the escaped symbol is treated as not escaped (<tt class="docutils literal">\A</tt> becomes <tt class="docutils literal">A</tt>, etc.).
The above example should be fixed as follows:</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span><span class="comment multiline">/*!re2c
</span><span class="ln">2 </span><span class="comment multiline">    *                    {}
</span><span class="ln">3 </span><span class="comment multiline">    &quot;\aA\&quot;'[]-\x5d\377&quot;  {}
</span><span class="ln">4 </span><span class="comment multiline">    '\aA&quot;\'[]-\x5d\377'  {}
</span><span class="ln">5 </span><span class="comment multiline">    [\aA&quot;'[\]\-\x5d\377] {}
</span><span class="ln">6 </span><span class="comment multiline">*/</span>
</pre>
</div>
<div class="section" id="how-it-works">
<h1>How it works</h1>
<p>re2c recognizes escapes in the following lexemes:</p>
<ul class="simple">
<li>double-quoted strings <tt class="docutils literal">&quot; ... &quot;</tt></li>
<li>single-quoted strings <tt class="docutils literal">' ... '</tt></li>
<li>character classes <tt class="docutils literal">[ ... ]</tt> and <tt class="docutils literal">[^ ... ]</tt></li>
</ul>
<p>The following escapes are recognized:</p>
<ul class="simple">
<li>Closing quotes (<tt class="docutils literal">\&quot;</tt> for double-quoted strings, <tt class="docutils literal">\'</tt> for single-quoted strings and <tt class="docutils literal">\]</tt> for character classes).</li>
<li>Dash <tt class="docutils literal">\-</tt> in character classes.</li>
<li>Octal escapes: <tt class="docutils literal">\ooo</tt>, where <tt class="docutils literal">o</tt> is in range <tt class="docutils literal">[0 - 7]</tt>
(maximal octal escape is <tt class="docutils literal">\377</tt>, which equals <tt class="docutils literal">0xFF</tt>).</li>
<li>Hexadecimal escapes: <tt class="docutils literal">\xhh</tt>, <tt class="docutils literal">\Xhhhh</tt>, <tt class="docutils literal">\uhhhh</tt> and <tt class="docutils literal">\Uhhhhhhhh</tt>,
where <tt class="docutils literal">h</tt> is in range <tt class="docutils literal">[0 - 9]</tt>, <tt class="docutils literal">[a - f]</tt> or <tt class="docutils literal">[A - F]</tt>.</li>
<li>Miscellaneous escapes: <tt class="docutils literal">\a</tt>, <tt class="docutils literal">\b</tt>, <tt class="docutils literal">\f</tt>, <tt class="docutils literal">\n</tt>, <tt class="docutils literal">\r</tt>, <tt class="docutils literal">\t</tt>, <tt class="docutils literal">\v</tt>, <tt class="docutils literal">\\</tt>.</li>
</ul>
<p>Ill-formed octal and hexadecimal escapes are treated as errors.
Escape followed by a newline is also an error: multiline strings and classes are not allowed
(this is very inconvenient; hopefully it will be fixed in future).
Any other ill-formed escapes are ignored.
If <tt class="docutils literal"><span class="pre">[-Wuseless-escape]</span></tt> is enabled, re2c warns about ignored escapes.</p>
</div>
<div class="section" id="real-world-examples">
<h1>Real-world examples</h1>
<p>I found many useless escapes in real-world programs:</p>
<ul class="simple">
<li>A very strange escape <tt class="docutils literal">\*</tt> in a regular expression like <tt class="docutils literal"><span class="pre">&quot;*\*&quot;</span></tt>:
either someone wanted to write <tt class="docutils literal"><span class="pre">&quot;*\\*&quot;</span></tt> (with backslash in the middle),
or I have no explanation at all (considering that the first <tt class="docutils literal">*</tt> is not escaped).
As far as I know re2c always treated <tt class="docutils literal"><span class="pre">&quot;*\*&quot;</span></tt> as <tt class="docutils literal"><span class="pre">&quot;**&quot;</span></tt>.</li>
<li><tt class="docutils literal">\h</tt> in character classes (e.g. <tt class="docutils literal">[ \h\t\v\f\r]</tt>):
perhaps someone confused <tt class="docutils literal">\h</tt> with horisontal tab
(or even hostname <tt class="docutils literal">:)</tt>).</li>
<li><tt class="docutils literal">\[</tt> in charater classes; this one is very common.</li>
<li><tt class="docutils literal">\/</tt> in character classes (e.g. <tt class="docutils literal"><span class="pre">[^\/\000]</span></tt>) and strings (e.g. <tt class="docutils literal"><span class="pre">&quot;\/*&quot;</span></tt>).
However, there is one interesting case: <tt class="docutils literal"><span class="pre">&quot;/****</span> State &#64;&#64; <span class="pre">***\/&quot;</span></tt>:
here unescaped slash would end multiline comment.
Perhaps <tt class="docutils literal"><span class="pre">[-Wuseless-escape]</span></tt> should be fixed to recognize such cases.</li>
<li><tt class="docutils literal">\.</tt> in character classes (e.g <tt class="docutils literal"><span class="pre">[\.]</span></tt>).</li>
</ul>
</div>
</div>
<div class="footer">
<hr class="footer" />
<a class="reference external" href="../../../index.html">[home]</a> <a class="reference external" href="../../manual.html">[Manual]</a> <a class="reference external" href="../warnings.html">[Warnings]</a>
</div>
</body>
</html>
