/* Generated by re2c 1.1.1 on Mon Jan 14 22:54:34 2019 */
#line 1 "../libre2c_posix/lex.re"
#include <stdio.h>

#include "src/util/c99_stdint.h"

#include "src/encoding/enc.h"
#include "src/parse/ast.h"
#include "src/options/msg.h"
#include "src/util/range.h"
#include "parse.h"
#include "libre2c_posix/lex.h"


extern YYSTYPE yylval;

namespace re2c {

static int32_t lex_cls_chr(const char *&, uint32_t &);

#line 27 "../libre2c_posix/lex.re"


int lex(const char *&cur)
{
    const char *mar;
    std::vector<ASTRange> cls;
    bool neg = false;
    uint32_t l, u;


#line 33 "libre2c_posix/lex.cc"
{
	char yych;
	yych = *cur;
	if (yych <= '>') {
		if (yych <= '-') {
			if (yych <= 0x00) goto yy2;
			if (yych <= '\'') goto yy4;
			if (yych <= '+') goto yy6;
			goto yy4;
		} else {
			if (yych <= '.') goto yy8;
			if (yych <= '/') goto yy4;
			if (yych <= '9') goto yy10;
			goto yy4;
		}
	} else {
		if (yych <= '[') {
			if (yych <= '?') goto yy6;
			if (yych <= '@') goto yy4;
			if (yych <= 'Z') goto yy12;
			goto yy14;
		} else {
			if (yych <= '`') goto yy4;
			if (yych <= 'z') goto yy12;
			if (yych <= '}') goto yy6;
			goto yy4;
		}
	}
yy2:
	++cur;
#line 39 "../libre2c_posix/lex.re"
	{ return 0; }
#line 66 "libre2c_posix/lex.cc"
yy4:
	++cur;
#line 37 "../libre2c_posix/lex.re"
	{ goto err; }
#line 71 "libre2c_posix/lex.cc"
yy6:
	++cur;
#line 41 "../libre2c_posix/lex.re"
	{ return cur[-1]; }
#line 76 "libre2c_posix/lex.cc"
yy8:
	++cur;
#line 46 "../libre2c_posix/lex.re"
	{
        yylval.regexp = ast_dot(0, 0);
        return REGEXP;
    }
#line 84 "libre2c_posix/lex.cc"
yy10:
	++cur;
#line 51 "../libre2c_posix/lex.re"
	{
        yylval.number = static_cast<uint32_t>(cur[-1] - '0');
        return DIGIT;
    }
#line 92 "libre2c_posix/lex.cc"
yy12:
	++cur;
#line 56 "../libre2c_posix/lex.re"
	{
        ASTChar c(static_cast<uint32_t>(cur[-1]), 0);
        std::vector<ASTChar> *str = new std::vector<ASTChar>;
        str->push_back(c);
        yylval.regexp = ast_str(0, 0, str, false);
        return REGEXP;
    }
#line 103 "libre2c_posix/lex.cc"
yy14:
	yych = *++cur;
	if (yych == '^') goto yy16;
#line 44 "../libre2c_posix/lex.re"
	{ goto cls; }
#line 109 "libre2c_posix/lex.cc"
yy16:
	++cur;
#line 43 "../libre2c_posix/lex.re"
	{ neg = true; goto cls; }
#line 114 "libre2c_posix/lex.cc"
}
#line 63 "../libre2c_posix/lex.re"


cls:
    if (lex_cls_chr(cur, l) != 0) goto err;

#line 122 "libre2c_posix/lex.cc"
{
	char yych;
	yych = *(mar = cur);
	if (yych == '-') goto yy21;
yy20:
#line 68 "../libre2c_posix/lex.re"
	{ u = l; goto add; }
#line 130 "libre2c_posix/lex.cc"
yy21:
	yych = *++cur;
	if (yych != ']') goto yy23;
	cur = mar;
	goto yy20;
yy23:
	++cur;
	cur -= 1;
#line 69 "../libre2c_posix/lex.re"
	{ if (lex_cls_chr(cur, u) != 0) goto err; goto add; }
#line 141 "libre2c_posix/lex.cc"
}
#line 70 "../libre2c_posix/lex.re"

add:
    if (l > u) goto err;
    cls.push_back(ASTRange(l, u, 0));

#line 149 "libre2c_posix/lex.cc"
{
	char yych;
	yych = *cur;
	if (yych == ']') goto yy28;
#line 75 "../libre2c_posix/lex.re"
	{ goto cls; }
#line 156 "libre2c_posix/lex.cc"
yy28:
	++cur;
#line 76 "../libre2c_posix/lex.re"
	{
        std::vector<ASTRange> *p = new std::vector<ASTRange>;
        p->swap(cls);
        yylval.regexp = ast_cls(0, 0, p, neg);
        return REGEXP;
    }
#line 166 "libre2c_posix/lex.cc"
}
#line 82 "../libre2c_posix/lex.re"


err:
    error("syntax error: %s\n", cur);
    return ERROR;
}

int32_t lex_cls_chr(const char *&cur, uint32_t &c)
{

#line 179 "libre2c_posix/lex.cc"
{
	char yych;
	yych = *cur;
	if (yych <= 0x00) goto yy32;
	if (yych == '[') goto yy36;
	goto yy34;
yy32:
	++cur;
#line 92 "../libre2c_posix/lex.re"
	{ return 1; }
#line 190 "libre2c_posix/lex.cc"
yy34:
	++cur;
yy35:
#line 97 "../libre2c_posix/lex.re"
	{ c = static_cast<uint8_t>(cur[-1]); return 0; }
#line 196 "libre2c_posix/lex.cc"
yy36:
	yych = *++cur;
	if (yych <= '9') {
		if (yych != '.') goto yy35;
	} else {
		if (yych <= ':') goto yy39;
		if (yych == '=') goto yy41;
		goto yy35;
	}
	++cur;
#line 93 "../libre2c_posix/lex.re"
	{ error("collating characters not supported"); return 1; }
#line 209 "libre2c_posix/lex.cc"
yy39:
	++cur;
#line 94 "../libre2c_posix/lex.re"
	{ error("character classes not supported"); return 1; }
#line 214 "libre2c_posix/lex.cc"
yy41:
	++cur;
#line 95 "../libre2c_posix/lex.re"
	{ error("equivalence classes not supported"); return 1; }
#line 219 "libre2c_posix/lex.cc"
}
#line 98 "../libre2c_posix/lex.re"

}

} // namespace re2c
