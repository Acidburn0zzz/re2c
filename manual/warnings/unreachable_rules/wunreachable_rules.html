
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>[-Wunreachable-rules] &#8212; re2c 1.0.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/theme-re2c.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="alternate" type="application/atom+xml" href="../../../feed/atom.xml" title="Atom 1.0" />
    
 
  </head>
  <body>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="re2c-logo">
    re2c-1.0.1
</div>

<h3><a href="../../../index.html">Home</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../about/about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/install.html">Install</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../manual.html">Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../options/options.html">Options</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../warnings.html">Warnings</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../undefined_control_flow/wundefined_control_flow.html">[-Wundefined-control-flow]</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">[-Wunreachable-rules]</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-simple-example">A simple example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#infinite-rules">Infinite rules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-it-works">How it works</a></li>
<li class="toctree-l4"><a class="reference internal" href="#real-world-examples">Real-world examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../condition_order/wcondition_order.html">[-Wcondition-order]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../useless_escape/wuseless_escape.html">[-Wuseless-escape]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../swapped_range/wswapped_range.html">[-Wswapped-range]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../empty_character_class/wempty_character_class.html">[-Wempty-character-class]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../match_empty_string/wmatch_empty_string.html">[-Wmatch-empty-string]</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../syntax/syntax.html">Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../features/features.html">Features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../news/news.html">News</a></li>
</ul>

    <h3>[-Wunreachable-rules]</h3>
    <div class="re2c-toc-local">
        <ul>
<li><a class="reference internal" href="#">[-Wunreachable-rules]</a><ul>
<li><a class="reference internal" href="#a-simple-example">A simple example</a></li>
<li><a class="reference internal" href="#infinite-rules">Infinite rules</a></li>
<li><a class="reference internal" href="#how-it-works">How it works</a></li>
<li><a class="reference internal" href="#real-world-examples">Real-world examples</a></li>
</ul>
</li>
</ul>

    </div>

        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="wunreachable-rules">
<h1>[-Wunreachable-rules]<a class="headerlink" href="#wunreachable-rules" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="a-simple-example">
<h2>A simple example<a class="headerlink" href="#a-simple-example" title="Permalink to this headline">¶</a></h2>
<div class="highlight-cpp"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*!re2c</span>
<span class="cm">    &quot;&quot;          { return &quot;&quot;; }</span>
<span class="cm">    *           { return &quot;*&quot;; }</span>
<span class="cm">    &quot;a&quot; | &quot;b&quot;   { return &quot;a | b&quot;; }</span>
<span class="cm">    &quot;a&quot;         { return &quot;a&quot;; }</span>
<span class="cm">    [\x00-\xFF] { return &quot;[0 - 0xFF]&quot;; }</span>
<span class="cm">    [^]         { return &quot;[^]&quot;; }</span>
<span class="cm">*/</span>
</pre></div>
</td></tr></table></div>
<p>Given this strange code, <code class="docutils literal"><span class="pre">`re2c</span> <span class="pre">-i</span> <span class="pre">-Wunreachable-rules`</span></code> says:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>re2c: warning: line 2: unreachable rule (shadowed by rules at lines 4, 6) [-Wunreachable-rules]
re2c: warning: line 5: unreachable rule (shadowed by rule at line 4) [-Wunreachable-rules]
re2c: warning: line 7: unreachable rule (shadowed by rule at line 6) [-Wunreachable-rules]
</pre></div>
</div>
<p>A look at the generated code suggests that re2c was right:</p>
<div class="highlight-cpp"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/* Generated by re2c 0.14.1.dev on Fri Nov  6 15:21:36 2015*/</span>

<span class="p">{</span>
        <span class="n">YYCTYPE</span> <span class="n">yych</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">YYLIMIT</span> <span class="o">&lt;=</span> <span class="n">YYCURSOR</span><span class="p">)</span> <span class="n">YYFILL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">yych</span> <span class="o">=</span> <span class="o">*</span><span class="n">YYCURSOR</span><span class="p">;</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">yych</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="sc">&#39;a&#39;</span><span class="o">:</span>       <span class="k">goto</span> <span class="n">yy5</span><span class="p">;</span>
        <span class="k">case</span> <span class="sc">&#39;b&#39;</span><span class="o">:</span>       <span class="k">goto</span> <span class="n">yy7</span><span class="p">;</span>
        <span class="k">default</span><span class="o">:</span>        <span class="k">goto</span> <span class="n">yy3</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="p">{</span> <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="p">;</span> <span class="p">}</span>
<span class="nl">yy3</span><span class="p">:</span>
        <span class="o">++</span><span class="n">YYCURSOR</span><span class="p">;</span>
        <span class="p">{</span> <span class="k">return</span> <span class="s">&quot;[0 - 0xFF]&quot;</span><span class="p">;</span> <span class="p">}</span>
<span class="nl">yy5</span><span class="p">:</span>
        <span class="o">++</span><span class="n">YYCURSOR</span><span class="p">;</span>
<span class="nl">yy6</span><span class="p">:</span>
        <span class="p">{</span> <span class="k">return</span> <span class="s">&quot;a | b&quot;</span><span class="p">;</span> <span class="p">}</span>
<span class="nl">yy7</span><span class="p">:</span>
        <span class="o">++</span><span class="n">YYCURSOR</span><span class="p">;</span>
        <span class="n">yych</span> <span class="o">=</span> <span class="o">*</span><span class="n">YYCURSOR</span><span class="p">;</span>
        <span class="k">goto</span> <span class="n">yy6</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Clearly, all the reported rules are unreachable (some of them are not even present in the generated code).
Default rule <code class="docutils literal"><span class="pre">*</span></code> at line 3 is also unreachable, but re2c appreciates paranoid attempts
to handle default case and never reports unreachable default rule.</p>
</div>
<div class="section" id="infinite-rules">
<h2>Infinite rules<a class="headerlink" href="#infinite-rules" title="Permalink to this headline">¶</a></h2>
<p>A rule may be unreachable all by itself, without being shadowed by other rules:</p>
<div class="highlight-cpp"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*!re2c</span>
<span class="cm">    [^]* { return &quot;greeedy&quot;; }</span>
<span class="cm">*/</span>
</pre></div>
</td></tr></table></div>
<p>This rule is so greedy that it never stops.
It will continue eating input until <code class="docutils literal"><span class="pre">YYFILL</span></code> finally fails (<code class="docutils literal"><span class="pre">`re2c</span> <span class="pre">-i</span> <span class="pre">-Wunreachable-rules`</span></code>):</p>
<div class="highlight-cpp"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/* Generated by re2c 0.14.1.dev on Fri Nov  6 21:36:56 2015*/</span>

<span class="p">{</span>
        <span class="n">YYCTYPE</span> <span class="n">yych</span><span class="p">;</span>
        <span class="k">goto</span> <span class="n">yy0</span><span class="p">;</span>
<span class="nl">yy1</span><span class="p">:</span>
        <span class="o">++</span><span class="n">YYCURSOR</span><span class="p">;</span>
<span class="nl">yy0</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">YYLIMIT</span> <span class="o">&lt;=</span> <span class="n">YYCURSOR</span><span class="p">)</span> <span class="n">YYFILL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">yych</span> <span class="o">=</span> <span class="o">*</span><span class="n">YYCURSOR</span><span class="p">;</span>
        <span class="k">goto</span> <span class="n">yy1</span><span class="p">;</span>
        <span class="p">{</span> <span class="k">return</span> <span class="s">&quot;greeedy&quot;</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>And if we suppress <code class="docutils literal"><span class="pre">YYFILL</span></code> generation with <code class="docutils literal"><span class="pre">re2c:yyfill:enable</span> <span class="pre">=</span> <span class="pre">0;</span></code>,
lexer will loop until segfault or another disaster forces its untimely shutdown
(unless you use <code class="docutils literal"><span class="pre">--input-api</span> <span class="pre">custom</span></code> and do some magic to stop it).
And re2c warns us:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>re2c: warning: line 2: unreachable rule  [-Wunreachable-rules]
</pre></div>
</div>
<p>All rules that include <code class="docutils literal"><span class="pre">[^]*</span></code> (or any component isomorphic to <code class="docutils literal"><span class="pre">[^]*</span></code>) are also infinite.</p>
</div>
<div class="section" id="how-it-works">
<h2>How it works<a class="headerlink" href="#how-it-works" title="Permalink to this headline">¶</a></h2>
<p>For each state of the generated DFA re2c calculates the set of all rules reachable from this state
(including default rule and no rule at all).
The algorithm starts with initial state and recurses to child states.
Recursion stops if either current state is final (then its set is trivial)
or the set for current state has already been calculated.
Thus each state is processed only once and the algorithm has <code class="docutils literal"><span class="pre">O(n)</span></code> complexity
(where <code class="docutils literal"><span class="pre">n</span></code> is the number of states in DFA).
When all the sets have been calculated, re2c checks that the set of rules
reachable from each accepting state includes either accepted rule or no rule at all.</p>
<p>Analyses is done regardless of the <code class="docutils literal"><span class="pre">-Wunreachable-rules</span></code> option,
the option only controls if the warning is reported or not.</p>
</div>
<div class="section" id="real-world-examples">
<h2>Real-world examples<a class="headerlink" href="#real-world-examples" title="Permalink to this headline">¶</a></h2>
<p>In many real-world examples re2c reports unreachable <code class="docutils literal"><span class="pre">[^]</span></code> rule,
which is quite understandable: <code class="docutils literal"><span class="pre">[^]</span></code> served as default rule long before
the true default rule <code class="docutils literal"><span class="pre">*</span></code> was added to re2c.
However, in some cases the warning is quite interesting.
Here is an example of a real-world lexer (all the non-re2c code has beed removed):</p>
<div class="highlight-cpp"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*!re2c</span>
<span class="cm">    re2c:yyfill:check = 0;</span>

<span class="cm">    LNUM                [0-9]+</span>
<span class="cm">    DNUM                ([0-9]*[\.][0-9]+)|([0-9]+[\.][0-9]*)</span>
<span class="cm">    NUMBER              [-]?{LNUM}|{DNUM}</span>
<span class="cm">    ANY_CHAR            (.|[\n\t])</span>
<span class="cm">    NEWLINE             (&quot;\r&quot;|&quot;\n&quot;|&quot;\r\n&quot;)</span>
<span class="cm">    TABS_AND_SPACES     [ \t]</span>
<span class="cm">    WHITESPACE          [ \t]+</span>
<span class="cm">    CONSTANT            [a-zA-Z_][a-zA-Z0-9_]*</span>
<span class="cm">    LABEL               [^=\n\r\t;&amp;|^$~(){}!&quot;\[]+</span>
<span class="cm">    TOKENS              [:,.\[\]&quot;&#39;()&amp;|^+-/*=%$!~&lt;&gt;?@{}]</span>
<span class="cm">    OPERATORS           [&amp;|^~()!]</span>
<span class="cm">    DOLLAR_CURLY        &quot;${&quot;</span>
<span class="cm">    SECTION_RAW_CHARS   [^\]\n\r]</span>
<span class="cm">    SINGLE_QUOTED_CHARS [^&#39;]</span>
<span class="cm">    RAW_VALUE_CHARS     [^\n\r;\000]</span>
<span class="cm">    LITERAL_DOLLAR      (&quot;$&quot;([^{\000]|(&quot;\\&quot;{ANY_CHAR})))</span>
<span class="cm">    VALUE_CHARS         ([^$= \t\n\r;&amp;|^~()!&quot;&#39;\000]|{LITERAL_DOLLAR})</span>
<span class="cm">    SECTION_VALUE_CHARS ([^$\n\r;&quot;&#39;\]\\]|(&quot;\\&quot;{ANY_CHAR})|{LITERAL_DOLLAR})</span>

<span class="cm">    &lt;INITIAL&gt;&quot;[&quot; {}</span>
<span class="cm">    &lt;ST_VALUE,ST_SECTION_VALUE,ST_OFFSET&gt;&quot;&#39;&quot;{SINGLE_QUOTED_CHARS}+&quot;&#39;&quot; {}</span>
<span class="cm">    &lt;ST_SECTION_RAW,ST_SECTION_VALUE&gt;&quot;]&quot;{TABS_AND_SPACES}*{NEWLINE}? {}</span>
<span class="cm">    &lt;INITIAL&gt;{LABEL}&quot;[&quot;{TABS_AND_SPACES}* {}</span>
<span class="cm">    &lt;ST_OFFSET&gt;{TABS_AND_SPACES}*&quot;]&quot; {}</span>
<span class="cm">    &lt;ST_DOUBLE_QUOTES,ST_SECTION_VALUE,ST_VALUE,ST_OFFSET&gt;{DOLLAR_CURLY} {}</span>
<span class="cm">    &lt;ST_VARNAME&gt;{LABEL} {}</span>
<span class="cm">    &lt;ST_VARNAME&gt;&quot;}&quot; {}</span>
<span class="cm">    &lt;INITIAL,ST_VALUE&gt;(&quot;true&quot;|&quot;on&quot;|&quot;yes&quot;){TABS_AND_SPACES}* {}</span>
<span class="cm">    &lt;INITIAL,ST_VALUE&gt;(&quot;false&quot;|&quot;off&quot;|&quot;no&quot;|&quot;none&quot;){TABS_AND_SPACES}* {}</span>
<span class="cm">    &lt;INITIAL,ST_VALUE&gt;(&quot;null&quot;){TABS_AND_SPACES}* {}</span>
<span class="cm">    &lt;INITIAL&gt;{LABEL} {}</span>
<span class="cm">    &lt;INITIAL&gt;{TABS_AND_SPACES}*[=]{TABS_AND_SPACES}* {}</span>
<span class="cm">    &lt;ST_RAW&gt;{RAW_VALUE_CHARS} {}</span>
<span class="cm">    &lt;ST_SECTION_RAW&gt;{SECTION_RAW_CHARS}+ {}</span>
<span class="cm">    &lt;ST_VALUE,ST_RAW&gt;{TABS_AND_SPACES}*{NEWLINE} {}</span>
<span class="cm">    &lt;ST_SECTION_VALUE,ST_VALUE,ST_OFFSET&gt;{CONSTANT} {}</span>
<span class="cm">    &lt;ST_SECTION_VALUE,ST_VALUE,ST_OFFSET&gt;{NUMBER} {}</span>
<span class="cm">    &lt;INITIAL&gt;{TOKENS} {}</span>
<span class="cm">    &lt;ST_VALUE&gt;{OPERATORS}{TABS_AND_SPACES}* {}</span>
<span class="cm">    &lt;ST_VALUE&gt;[=] {}</span>
<span class="cm">    &lt;ST_VALUE&gt;{VALUE_CHARS}+ {}</span>
<span class="cm">    &lt;ST_SECTION_VALUE,ST_OFFSET&gt;{SECTION_VALUE_CHARS}+ {}</span>
<span class="cm">    &lt;ST_SECTION_VALUE,ST_VALUE,ST_OFFSET&gt;{TABS_AND_SPACES}*[&quot;] {}</span>
<span class="cm">    &lt;ST_DOUBLE_QUOTES&gt;[&quot;]{TABS_AND_SPACES}* {}</span>
<span class="cm">    &lt;ST_DOUBLE_QUOTES&gt;[^] {}</span>
<span class="cm">    &lt;ST_SECTION_VALUE,ST_VALUE,ST_OFFSET&gt;{WHITESPACE} {}</span>
<span class="cm">    &lt;INITIAL,ST_RAW&gt;{TABS_AND_SPACES}+ {}</span>
<span class="cm">    &lt;INITIAL&gt;{TABS_AND_SPACES}*{NEWLINE} {}</span>
<span class="cm">    &lt;INITIAL,ST_VALUE,ST_RAW&gt;{TABS_AND_SPACES}*[;][^\r\n]*{NEWLINE} {}</span>
<span class="cm">    &lt;ST_VALUE,ST_RAW&gt;[^] {}</span>
<span class="cm">    &lt;*&gt;[^] {}</span>
<span class="cm">*/</span>
</pre></div>
</td></tr></table></div>
<p><code class="docutils literal"><span class="pre">`re2c</span> <span class="pre">-cF</span> <span class="pre">-Wunreachable-rules`</span></code> says:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>re2c: warning: line 54: unreachable rule in condition &#39;ST_DOUBLE_QUOTES&#39; (shadowed by rules at lines 47, 48) [-Wunreachable-rules]
re2c: warning: line 49: unreachable rule in condition &#39;ST_OFFSET&#39; (shadowed by rule at line 45) [-Wunreachable-rules]
re2c: warning: line 54: unreachable rule in condition &#39;ST_RAW&#39; (shadowed by rules at lines 36, 38, 53) [-Wunreachable-rules]
re2c: warning: line 49: unreachable rule in condition &#39;ST_SECTION_VALUE&#39; (shadowed by rule at line 45) [-Wunreachable-rules]
re2c: warning: line 54: unreachable rule in condition &#39;ST_VALUE&#39; (shadowed by rules at lines 38, 39, 40, 42, 43, 44, 46, 49, 53) [-Wunreachable-rules]
</pre></div>
</div>
<p>The interesting part is the unreachable rule on line 49 in conditions <code class="docutils literal"><span class="pre">ST_OFFSET</span></code> and <code class="docutils literal"><span class="pre">ST_SECTION_VALUE</span></code>.
The rule is <code class="docutils literal"><span class="pre">{WHITESPACE}</span></code>:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>WHITESPACE [ \t]+
</pre></div>
</div>
<p>re2c claims that it is shadowed by the rule on line 45, which is <code class="docutils literal"><span class="pre">{SECTION_VALUE_CHARS}+</span></code>:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>ANY_CHAR            (.|[\n\t])
LITERAL_DOLLAR      (&quot;$&quot;([^{\000]|(&quot;\\&quot;{ANY_CHAR})))
SECTION_VALUE_CHARS ([^$\n\r;&quot;&#39;\]\\]|(&quot;\\&quot;{ANY_CHAR})|{LITERAL_DOLLAR})
</pre></div>
</div>
<p>Indeed, <code class="docutils literal"><span class="pre">{SECTION_VALUE_CHARS}+</span></code> allows all the patterns accepted by <code class="docutils literal"><span class="pre">{WHITESPACE}</span></code>.
In the original program these rules return different types of tokens:
perhaps this is not critical, but clearly unintended.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">
      Last updated on Aug 28, 2017.
    </div>
  </body>
</html>