#!/bin/sh
mkdir @builddir@/test
result=0
for x in @top_srcdir@/test/*.re; do
	echo $x
	# don't use the -o flag, since it makes it harder to diff.
	outname=@builddir@/test/`basename ${x%.re}.temp`
	@builddir@/re2c $x | sed -e "s,$x,`basename $x`,g" -e "s,/\* Generated by re2c .*\*/,,g" > $outname
	if cmp -s ${x%.re}.c $outname; then
		echo "Passed."
		rm $outname
	else
		echo "Failed: ${x%.re}.c ${x%.re}.temp differ."
		result=1
	fi
done
exit $result
