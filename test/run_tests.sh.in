#!/bin/sh
for x in @srcdir@/test/*.re; do
	echo $x
	# don't use the -o flag, since it makes it harder to diff.
	@builddir@/re2c $x | sed -e "s,$x,`basename $x`,g" -e "s,/\* Generated by re2c .*\*/,,g" > ${x%.re}.temp
	if diff ${x%.re}.c ${x%.re}.temp; then
		echo "Passed."
		rm ${x%.re}.temp
	else
		echo "Failed."
		exit 1
	fi
done

